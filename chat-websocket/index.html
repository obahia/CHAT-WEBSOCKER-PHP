<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chat BahiaSocker</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <div id="loginArea">
    <h2>Entrar no Chat</h2>
  
    <input id="InputUsername"  placeholder="Seu nome..." />
  
    <div id="salaListContainer">
      <p>Salas disponíveis:</p>
      <ul id="listaSalas"></ul>
    </div>
  
    <input id="inputNovaSala"  placeholder="Ou crie uma nova sala..." />
  
    <button id="btnEntrar">Entrar</button>
  </div>

  <div id="app">
    <div id="topBar">
      Sala: <span id="nomeSala"></span>
      <button id="btnSair">Sair</button>
    </div>

    <ul id="chat"></ul>

    <div id="inputArea">
      <input id="msg" placeholder="Digite uma mensagem..." autocomplete="off" />
      <button id="btnEnviar">Enviar</button>
    </div>


  </div>

  <script>
    const loginArea = document.getElementById("loginArea");
    const app = document.getElementById("app");
    const nomeInput = document.getElementById("InputUsername");
    const inputNovaSala = document.getElementById("inputNovaSala");
    const listaSalas = document.getElementById("listaSalas");
    const btnEntrar = document.getElementById("btnEntrar");
    const btnSair = document.getElementById("btnSair");
    const nomeSala = document.getElementById("nomeSala");
    const chat = document.getElementById("chat");
    const msgInput = document.getElementById("msg");
    const btnEnviar = document.getElementById("btnEnviar");
  
    let socket;
    let nome = "";
    let sala = "";
    let salaSelecionada = "";
  
    // Exemplo de salas disponíveis (tu pode trocar isso depois pra vir do backend)
    const salasDisponiveis = ["geral", "programação", "games", "aleatório"];
  
    // Renderiza a lista de salas
    salasDisponiveis.forEach((salaNome) => {
      const li = document.createElement("li");
      li.textContent = salaNome;
  
      li.addEventListener("click", () => {
        document.querySelectorAll("#listaSalas li").forEach(el => el.classList.remove("selected"));
        li.classList.add("selected");
        salaSelecionada = salaNome;
        inputNovaSala.value = ""; // limpa input se selecionar
      });
  
      listaSalas.appendChild(li);
    });
  
    btnEntrar.addEventListener("click", () => {
      nome = nomeInput.value.trim();
      
      const novaSala = inputNovaSala.value.trim();
      sala = novaSala || salaSelecionada;
  
      if (!nome || !sala) {
        alert("Preencha seu nome e selecione ou crie uma sala!");
        return;
      }
  
      entrarNoChat(nome, sala);
    });
  
    btnSair.addEventListener("click", () => {
      if (socket && socket.readyState === WebSocket.OPEN) {
        socket.send(JSON.stringify({ tipo: "sair" }));
        socket.close();
      }
  
      socket = null;
      nome = "";
      sala = "";
      salaSelecionada = "";
  
      app.style.display = "none";
      loginArea.style.display = "block";
      chat.innerHTML = "";
      nomeSala.textContent = "Nenhuma";
      nomeInput.value = "";
      inputNovaSala.value = "";
      document.querySelectorAll("#listaSalas li").forEach(el => el.classList.remove("selected"));
    });
  
    btnEnviar.addEventListener("click", enviarMensagem);
  
    msgInput.addEventListener("keypress", (e) => {
      if (e.key === "Enter") enviarMensagem();
    });
  
    function entrarNoChat(nomeUser, salaUser) {
      loginArea.style.display = "none";
      app.style.display = "flex";
      nomeSala.textContent = salaUser;
      chat.innerHTML = "";
  
      socket = new WebSocket("ws://localhost:8080");
  
      socket.onopen = () => {
        socket.send(JSON.stringify({ tipo: "entrar", nome: nomeUser, sala: salaUser }));
      };
  
      socket.onmessage = (event) => {
        const data = JSON.parse(event.data);
  
        if (data.tipo === "mensagem") {
          adicionaMensagem(data.texto, data.autor === nome);
        }
      };
  
      socket.onclose = () => {
        chat.innerHTML = "";
      };
    }
  
    function enviarMensagem() {
      const texto = msgInput.value.trim();
      if (!texto || !socket || socket.readyState !== WebSocket.OPEN) return;
  
      const mensagem = `${nome}: ${texto}`;
      socket.send(JSON.stringify({ tipo: "mensagem", texto: mensagem, autor: nome }));
      adicionaMensagem(mensagem, true);
      msgInput.value = "";
      msgInput.focus();
    }
  
    function adicionaMensagem(texto, isOwn) {
      const li = document.createElement("li");
      li.textContent = texto;
      if (isOwn) li.classList.add("own");
      chat.appendChild(li);
      chat.scrollTop = chat.scrollHeight;
    }
  </script>
  
</body>

</html>